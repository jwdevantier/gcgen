<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Getting Started &#8212; gcgen  documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css" />
    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Motivation" href="../motivation.html" />
    <link rel="prev" title="gcgen Documentation" href="../index.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <section id="getting-started">
<span id="sec-getting-started"></span><h1>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">¶</a></h1>
<section id="example">
<h2>Example<a class="headerlink" href="#example" title="Permalink to this heading">¶</a></h2>
<p>Let’s start by way of an example. Note that several concepts are introduced
here such as snippets, scope and the gcgen configuration file format - we will
cover all of these in the coming sections, this example will just serve to
illustrate the concept.</p>
<p>Consider the following toy example, where the modulo (<code class="docutils literal notranslate"><span class="pre">mod</span></code>) and exponent
(<code class="docutils literal notranslate"><span class="pre">exp</span></code>) functions are hand-written, but we wish to generate the functions for
addition (<code class="docutils literal notranslate"><span class="pre">add</span></code>), subtraction (<code class="docutils literal notranslate"><span class="pre">sub</span></code>), division (<code class="docutils literal notranslate"><span class="pre">div</span></code>) and multiplication
(<code class="docutils literal notranslate"><span class="pre">mul</span></code>):</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">my_mathlib.py - before code generation</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;This library contains some arithmetic functions&quot;&quot;&quot;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="k">def</span> <span class="nf">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos"> 4</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span>
<span class="hll"><span class="linenos"> 7</span><span class="c1"># &lt;&lt;? common_math_funcs [[&quot;add&quot;, &quot;+&quot;], [&quot;sub&quot;, &quot;-&quot;], [&quot;div&quot;, &quot;/&quot;], [&quot;mul&quot;, &quot;*&quot;]] ?&gt;&gt;</span>
</span><span class="hll"><span class="linenos"> 8</span><span class="c1"># &lt;&lt;? /common_math_funcs ?&gt;&gt;</span>
</span><span class="linenos"> 9</span>
<span class="linenos">10</span>
<span class="linenos">11</span><span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">exponent</span><span class="p">):</span>
<span class="linenos">12</span>    <span class="k">return</span> <span class="n">number</span> <span class="o">**</span> <span class="n">exponent</span>
</pre></div>
</div>
</div>
<p>Note the highlighted lines - these identify the start- and end of a <em>snippet</em>.
Snippets are regions of auto-generated code in an otherwise hand-written source
file.
In this case, it is referencing some snippet called <code class="docutils literal notranslate"><span class="pre">common_math_funcs</span></code>, when
gcgen is run, it will resolve this name to a function (an implementation) of
the snippet, which defines, through code, what the output should be.</p>
<p>The following configuration file implements the snippet, starting at line 5,
and tells gcgen to process the <code class="docutils literal notranslate"><span class="pre">my_mathlib.py</span></code>, expanding any snippets, by
defining the <code class="docutils literal notranslate"><span class="pre">gcgen_parse_files</span></code> hook in line 27-30:</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">gcgen_conf.py – gcgen configuration file</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">gcgen.api</span> <span class="kn">import</span> <span class="n">Section</span><span class="p">,</span> <span class="n">Scope</span><span class="p">,</span> <span class="n">Json</span><span class="p">,</span> <span class="n">snippet</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="c1"># Snippets are annotated `@snippet(&quot;&lt;name&gt;&quot;)`</span>
<span class="linenos"> 5</span><span class="nd">@snippet</span><span class="p">(</span><span class="s2">&quot;common_math_funcs&quot;</span><span class="p">)</span>
<span class="linenos"> 6</span><span class="k">def</span> <span class="nf">gen_arithmetic_ops</span><span class="p">(</span><span class="n">sec</span><span class="p">:</span> <span class="n">Section</span><span class="p">,</span> <span class="n">s</span><span class="p">:</span> <span class="n">Scope</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Json</span><span class="p">):</span>
<span class="linenos"> 7</span>    <span class="n">first</span> <span class="o">=</span> <span class="kc">True</span>
<span class="linenos"> 8</span>    <span class="k">for</span> <span class="n">lbl</span><span class="p">,</span> <span class="n">op</span> <span class="ow">in</span> <span class="n">val</span><span class="p">:</span>
<span class="linenos"> 9</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">first</span><span class="p">:</span>
<span class="linenos">10</span>            <span class="n">sec</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
<span class="linenos">11</span>            <span class="n">sec</span><span class="o">.</span><span class="n">newline</span><span class="p">()</span>
<span class="linenos">12</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">13</span>            <span class="n">first</span> <span class="o">=</span> <span class="kc">False</span>
<span class="linenos">14</span>        <span class="n">sec</span><span class="o">.</span><span class="n">emitln</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;def </span><span class="si">{</span><span class="n">lbl</span><span class="si">}</span><span class="s2">(x, y):&quot;</span><span class="p">)</span>
<span class="linenos">15</span>        <span class="n">sec</span><span class="o">.</span><span class="n">indent</span><span class="p">()</span>
<span class="linenos">16</span>        <span class="n">sec</span><span class="o">.</span><span class="n">emitln</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;return x </span><span class="si">{</span><span class="n">op</span><span class="si">}</span><span class="s2"> y&quot;</span><span class="p">)</span>
<span class="linenos">17</span>        <span class="n">sec</span><span class="o">.</span><span class="n">dedent</span><span class="p">()</span>
<span class="linenos">18</span>
<span class="linenos">19</span>
<span class="linenos">20</span><span class="k">def</span> <span class="nf">gcgen_parse_files</span><span class="p">():</span>
<span class="linenos">21</span>    <span class="c1"># tell gcgen which files to process for snippets</span>
<span class="linenos">22</span>    <span class="c1"># inside of this directory.</span>
<span class="linenos">23</span>    <span class="k">return</span> <span class="p">[</span><span class="s2">&quot;my_mathlib.py&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>Given this configuration file, running <code class="docutils literal notranslate"><span class="pre">gcgen</span></code> changes <code class="docutils literal notranslate"><span class="pre">my_mathlib.py</span></code>
to have the following contents:</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">my_mathlib.py - after code generation</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="sd">&quot;&quot;&quot;This library contains some arithmetic functions&quot;&quot;&quot;</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span>
<span class="linenos"> 4</span><span class="k">def</span> <span class="nf">mod</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos"> 5</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">%</span> <span class="n">y</span>
<span class="linenos"> 6</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="c1"># &lt;&lt;? common_math_funcs [[&quot;add&quot;, &quot;+&quot;], [&quot;sub&quot;, &quot;-&quot;], [&quot;div&quot;, &quot;/&quot;], [&quot;mul&quot;, &quot;*&quot;]] ?&gt;&gt;</span>
<span class="linenos"> 9</span><span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos">10</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">+</span> <span class="n">y</span>
<span class="linenos">11</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="k">def</span> <span class="nf">sub</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos">14</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">-</span> <span class="n">y</span>
<span class="linenos">15</span>
<span class="linenos">16</span>
<span class="linenos">17</span><span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos">18</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">/</span> <span class="n">y</span>
<span class="linenos">19</span>
<span class="linenos">20</span>
<span class="linenos">21</span><span class="k">def</span> <span class="nf">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="linenos">22</span>    <span class="k">return</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span>
<span class="linenos">23</span>
<span class="linenos">24</span>
<span class="linenos">25</span><span class="c1"># &lt;&lt;? /common_math_funcs ?&gt;&gt;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>
<span class="linenos">28</span><span class="k">def</span> <span class="nf">exp</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">exponent</span><span class="p">):</span>
<span class="linenos">29</span>    <span class="k">return</span> <span class="n">number</span><span class="o">**</span><span class="n">exponent</span>
</pre></div>
</div>
</div>
<p>This example is a toy example, it demonstrates the basic concept, but
cannot really illustrate the potential of code generation.
As you come to understand scope and how subdirectories in your projects
can contain their own <cite>gcgen_conf.py</cite> files which extend the scope, define new
snippets or override the implementation of existing ones,</p>
</section>
<section id="a-high-level-introduction-to-gcg">
<h2>A high-level introduction to gcg<a class="headerlink" href="#a-high-level-introduction-to-gcg" title="Permalink to this heading">¶</a></h2>
<section id="snippets-generators">
<h3>Snippets &amp; Generators<a class="headerlink" href="#snippets-generators" title="Permalink to this heading">¶</a></h3>
<p>gcg supports two forms of code generation, snippets and generators, both
generate code using a <a class="reference internal" href="../reference/section/index.html#sec-ref-section"><span class="std std-ref">section</span></a>, which provides a
convenient API for writing output, lines and handling indentation.</p>
<p><a class="reference internal" href="../reference/snippets/index.html#sec-ref-snippets"><span class="std std-ref">Snippets</span></a>, as shown above, mark regions within a
file, whose contents are auto-generated and will be rewritten each time gcgen
is run.</p>
<p>By contrast <a class="reference internal" href="../reference/generators/index.html#sec-ref-generators"><span class="std std-ref">generators</span></a> are functions in a gcgen
file (see next paragraph), which are mostly useful when generating files,
where the number and naming of the files is dynamic and depends on some input
data or model.</p>
<p>Each snippet and generator are passed two objects, a
<a class="reference internal" href="../reference/section/index.html#sec-ref-section"><span class="std std-ref">section</span></a> as mentioned before, and a
<a class="reference internal" href="../reference/scope/index.html#sec-ref-scope"><span class="std std-ref">scope</span></a>.</p>
</section>
<section id="scope">
<h3>Scope<a class="headerlink" href="#scope" title="Permalink to this heading">¶</a></h3>
<p>The <a class="reference internal" href="../reference/scope/index.html#sec-ref-scope"><span class="std std-ref">scope</span></a> functions as a lexical scope or a layered
dictionary. When looking up a variable in a scope, the key is first checked
against the inner-most scope, the instance you are holding. If the key is not
found, the key is then searched for in the parent scope, and so on, until
reaching the top scope.</p>
<p>In essence this allows a derived/child scope to set values in its own scope
without impacting the parent scope(s), while still being able to read values
from the parent scopes.</p>
<p>Each subdirectory containing a <a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-gcgen-file"><span class="std std-ref">gcgen file</span></a> creates
a new scope, and the configuration file may modify the scope’s definitions by
implementing the <a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-conf-extend"><span class="std std-ref">gcgen_scope_extend</span></a> function.</p>
<p>Each generator and each file being parsed for snippets gets their own scope.</p>
</section>
<section id="the-gcgen-file-s">
<h3>The gcgen file(s)<a class="headerlink" href="#the-gcgen-file-s" title="Permalink to this heading">¶</a></h3>
<p>Both snippets and generators are defined in a
<a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-gcgen-file"><span class="std std-ref">gcgen file</span></a>. These files are always named
<code class="docutils literal notranslate"><span class="pre">gcgen_conf.py</span></code>.
When running <code class="docutils literal notranslate"><span class="pre">gcgen</span></code> inside a project, these files are imported and their
definitions are used.</p>
<p>These files define snippets, generators, mark which files in a directory should
be parsed (meaning, scanned for snippets to expand) and they manage the
<a class="reference internal" href="../reference/scope/index.html#sec-ref-scope"><span class="std std-ref">scope</span></a>, which is passed along to each snippet and
generator when called.</p>
</section>
<section id="the-compile-process">
<h3>The compile process<a class="headerlink" href="#the-compile-process" title="Permalink to this heading">¶</a></h3>
<p id="sec-intro-compile">The gcgen compile process traverses down the project hierarchy of directories,
importing each directory’s <a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-gcgen-file"><span class="std std-ref">gcgen file</span></a> as they
encounter them.</p>
<p>After importing a <a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-gcgen-file"><span class="std std-ref">gcgen file</span></a>, they create a new
child scope and run the <a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-conf-extend"><span class="std std-ref">gcgen_scope_extend</span></a> hook,
if defined, which can add or remove variables from the scope.</p>
<p>Furthermore, the compiler also maintains a mapping of snippet definitions.
Any snippets defined in the <a class="reference internal" href="../reference/gcgen_file/index.html#sec-ref-gcgen-file"><span class="std std-ref">gcgen file</span></a> extend the
mapping, possibly overriding similarly named snippets from parent directories.
These snippet definitions, in turn, are available for use in any file contained
in the current directory, or any of its subdirectories.</p>
<p>Snippet and generator execution is done in a depth-first manner, meaning the
snippets and generators in the deepest subdirectories are executed first, and
any snippets and generators in the project root directory are executed last.</p>
</section>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">gcgen</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=jwdevantier&repo=gcgen&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">Getting Started</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#example">Example</a></li>
<li class="toctree-l2"><a class="reference internal" href="#a-high-level-introduction-to-gcg">A high-level introduction to gcg</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../motivation.html">Motivation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../design.html">Design Choices</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/installing_gcgen/index.html">Installing gcgen</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/starting_a_project/index.html">Starting a project</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/gcgen_file/index.html">gcgen file</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/scope/index.html">Scope</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/snippets/index.html">Snippets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/generators/index.html">Generators</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/section/index.html">Section</a></li>
<li class="toctree-l1"><a class="reference internal" href="../reference/api/index.html">gcgen API</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
      <li>Previous: <a href="../index.html" title="previous chapter">gcgen Documentation</a></li>
      <li>Next: <a href="../motivation.html" title="next chapter">Motivation</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Jesper Devantier.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 7.0.1</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.13</a>
      
      |
      <a href="../_sources/getting_started/index.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>